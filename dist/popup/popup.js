"use strict";(()=>{var r={targetLufs:-16,windowMs:3e3,updateIntervalMs:100,maxGainDb:3,maxGainChangeDbPerS:1,gateLufs:-60,boostBelowLufs:-35},i={thresholdDb:-24,ratio:6,attackMs:15,releaseMs:400,windowMs:100,kneeDb:6},l={thresholdDb:-3,lookaheadMs:5,attackMs:1,releaseMs:50},c={ceilingDbTp:-2,lookaheadMs:1.5,releaseMs:50},S={highPassHz:80,lowShelfHz:200,lowShelfGainDb:0,peakingHz:3e3,peakingGainDb:0,peakingQ:.7,highShelfHz:6e3,highShelfGainDb:-4},D={highPassHz:0,lowShelfHz:150,lowShelfGainDb:0,peakingHz:4e3,peakingGainDb:0,peakingQ:.8,highShelfHz:1e4,highShelfGainDb:0},P={highPassHz:80,lowShelfHz:300,lowShelfGainDb:-3,peakingHz:3e3,peakingGainDb:0,peakingQ:.8,highShelfHz:7e3,highShelfGainDb:0},T={highPassHz:80,lowShelfHz:150,lowShelfGainDb:0,peakingHz:3e3,peakingGainDb:0,peakingQ:.7,highShelfHz:4e3,highShelfGainDb:0},u={separator:{enabled:!1,vocalGainDb:0,musicReductionDb:-12}},L=[{id:"sleep",name:"Sleep",description:"Warm tone, gentle dynamics, optimized for falling asleep",playbackRate:.94,params:{worklet:{normalizer:{...r,targetLufs:-26},compressor:{...i},limiter:{...l},truePeak:{...c}},eq:{...S},eqEnabled:!0,masterGainDb:-6,vocal:{separator:{enabled:!0,vocalGainDb:0,musicReductionDb:-6}}}},{id:"asmr",name:"ASMR",description:"Preserve sub-harmonics, enhance whisper texture",playbackRate:1,params:{worklet:{normalizer:{...r,targetLufs:-28},compressor:{...i,thresholdDb:-26},limiter:{...l,thresholdDb:-6},truePeak:{...c}},eq:{...D},eqEnabled:!0,masterGainDb:-6,vocal:{...u}}},{id:"podcast",name:"Podcast",description:"Vocal clarity, reduced mud, enhanced presence",playbackRate:.94,params:{worklet:{normalizer:{...r,targetLufs:-24},compressor:{...i,thresholdDb:-20,ratio:3,attackMs:20,releaseMs:300,kneeDb:8},limiter:{...l},truePeak:{...c,ceilingDbTp:-1}},eq:{...P},eqEnabled:!0,masterGainDb:-3,vocal:{separator:{enabled:!0,vocalGainDb:3,musicReductionDb:-6}}}},{id:"whitenoise",name:"White Noise",description:"Lower target loudness, minimal processing",playbackRate:1,params:{worklet:{normalizer:{...r,targetLufs:-26},compressor:{...i,thresholdDb:-22,ratio:3,attackMs:20,releaseMs:300},limiter:{...l,thresholdDb:-6},truePeak:{...c}},eq:{...T},eqEnabled:!1,masterGainDb:-3,vocal:{...u}}}];function p(a){return L.find(t=>t.id===a)}var b="sleep";var v={enabled:!1,presetId:b,masterGainDb:-6,eqEnabled:!0,vocalEnhance:!0};async function g(){return await chrome.storage.sync.get(v)}async function s(a){await chrome.storage.sync.set(a)}var n=a=>document.querySelector(a),k=a=>document.querySelectorAll(a),M=n("#statusDot"),y=n("#statusText"),E=n("#toggleBtn"),q=n("#toggleLabel"),m=n("#eqToggle"),A=n("#lufsValue"),R=n("#grValue"),x=n("#inputPeakValue"),h=k(".preset-card"),f=n("#vocalToggle"),e={enabled:!1,presetId:"sleep",eqEnabled:!0,vocalEnhance:!1,currentLufs:null,gainReductionDb:null,inputPeakDb:null};function o(){E.classList.toggle("active",e.enabled),q.textContent=e.enabled?"Sleep Mode active":"Tap to activate",M.classList.toggle("active",e.enabled),y.textContent=e.enabled?"Processing":"Standby",h.forEach(a=>{let t=a.dataset.preset===e.presetId;a.classList.toggle("active",t)}),m.classList.toggle("active",e.eqEnabled),f.classList.toggle("active",e.vocalEnhance),A.textContent=e.currentLufs!==null?e.currentLufs.toFixed(1):"--",R.textContent=e.gainReductionDb!==null?`${e.gainReductionDb.toFixed(1)} dB`:"-- dB",x.textContent=e.inputPeakDb!==null&&isFinite(e.inputPeakDb)?`${e.inputPeakDb.toFixed(1)} dB`:"-inf dB"}function d(a){chrome.runtime.sendMessage(a).catch(()=>{})}async function H(){try{let a=await chrome.runtime.sendMessage({type:"GET_STATUS"});a?.type==="STATUS"&&(e.enabled=a.data.enabled,e.presetId=a.data.presetId,e.vocalEnhance=a.data.vocalEnhance,o())}catch{}}chrome.runtime.onMessage.addListener(a=>{a.type==="METERING"?(e.currentLufs=a.data.currentLufs,e.gainReductionDb=a.data.gainReductionDb,e.inputPeakDb=a.data.inputPeakDb,o()):a.type==="STATUS"&&(e.enabled=a.data.enabled,e.presetId=a.data.presetId,e.vocalEnhance=a.data.vocalEnhance,o())});function w(){e.enabled=!e.enabled,s({enabled:e.enabled}),d({type:"SET_ENABLED",enabled:e.enabled}),e.enabled||(e.currentLufs=null,e.gainReductionDb=null,e.inputPeakDb=null),o()}function G(a){e.presetId=a;let t=p(a);t&&(e.eqEnabled=t.params.eqEnabled,e.vocalEnhance=t.params.vocal.separator.enabled),s({presetId:a,eqEnabled:e.eqEnabled,vocalEnhance:e.vocalEnhance}),d({type:"SET_PRESET",presetId:a}),o()}function C(){e.eqEnabled=!e.eqEnabled,s({eqEnabled:e.eqEnabled}),d({type:"SET_EQ_ENABLED",enabled:e.eqEnabled}),o()}function _(){e.vocalEnhance=!e.vocalEnhance,s({vocalEnhance:e.vocalEnhance}),d({type:"SET_VOCAL_ENHANCE",enabled:e.vocalEnhance}),o()}function z(){E.addEventListener("click",w),h.forEach(a=>{a.addEventListener("click",()=>{let t=a.dataset.preset;t&&G(t)})}),m.addEventListener("click",C),f.addEventListener("click",_)}async function I(){let a=await g();e.enabled=a.enabled,e.presetId=a.presetId,e.eqEnabled=a.eqEnabled,e.vocalEnhance=a.vocalEnhance,z(),o(),H()}document.addEventListener("DOMContentLoaded",I);})();
