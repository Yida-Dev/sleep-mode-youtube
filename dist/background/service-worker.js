var r={targetLufs:-16,windowMs:3e3,updateIntervalMs:100,maxGainDb:3,maxGainChangeDbPerS:1,gateLufs:-60,boostBelowLufs:-35},s={thresholdDb:-24,ratio:6,attackMs:15,releaseMs:400,windowMs:100,kneeDb:6},i={thresholdDb:-3,lookaheadMs:5,attackMs:1,releaseMs:50},l={ceilingDbTp:-2,lookaheadMs:1.5,releaseMs:50},S={highPassHz:80,lowShelfHz:200,lowShelfGainDb:0,peakingHz:3e3,peakingGainDb:0,peakingQ:.7,highShelfHz:6e3,highShelfGainDb:-4},f={highPassHz:0,lowShelfHz:150,lowShelfGainDb:0,peakingHz:4e3,peakingGainDb:0,peakingQ:.8,highShelfHz:1e4,highShelfGainDb:0},g={highPassHz:80,lowShelfHz:300,lowShelfGainDb:-3,peakingHz:3e3,peakingGainDb:0,peakingQ:.8,highShelfHz:7e3,highShelfGainDb:0},T={highPassHz:80,lowShelfHz:150,lowShelfGainDb:0,peakingHz:3e3,peakingGainDb:0,peakingQ:.7,highShelfHz:4e3,highShelfGainDb:0},d={separator:{enabled:!1,vocalGainDb:0,musicReductionDb:-12}},k=[{id:"sleep",name:"Sleep",description:"Warm tone, gentle dynamics, optimized for falling asleep",playbackRate:.94,params:{worklet:{normalizer:{...r,targetLufs:-26},compressor:{...s},limiter:{...i},truePeak:{...l}},eq:{...S},eqEnabled:!0,masterGainDb:-6,vocal:{separator:{enabled:!0,vocalGainDb:0,musicReductionDb:-6}}}},{id:"asmr",name:"ASMR",description:"Preserve sub-harmonics, enhance whisper texture",playbackRate:1,params:{worklet:{normalizer:{...r,targetLufs:-28},compressor:{...s,thresholdDb:-26},limiter:{...i,thresholdDb:-6},truePeak:{...l}},eq:{...f},eqEnabled:!0,masterGainDb:-6,vocal:{...d}}},{id:"podcast",name:"Podcast",description:"Vocal clarity, reduced mud, enhanced presence",playbackRate:.94,params:{worklet:{normalizer:{...r,targetLufs:-24},compressor:{...s,thresholdDb:-20,ratio:3,attackMs:20,releaseMs:300,kneeDb:8},limiter:{...i},truePeak:{...l,ceilingDbTp:-1}},eq:{...g},eqEnabled:!0,masterGainDb:-3,vocal:{separator:{enabled:!0,vocalGainDb:3,musicReductionDb:-6}}}},{id:"whitenoise",name:"White Noise",description:"Lower target loudness, minimal processing",playbackRate:1,params:{worklet:{normalizer:{...r,targetLufs:-26},compressor:{...s,thresholdDb:-22,ratio:3,attackMs:20,releaseMs:300},limiter:{...i,thresholdDb:-6},truePeak:{...l}},eq:{...T},eqEnabled:!1,masterGainDb:-3,vocal:{...d}}}];var m="sleep";var y={enabled:!1,presetId:m,masterGainDb:-6,eqEnabled:!0,vocalEnhance:!0};async function u(){return await chrome.storage.sync.get(y)}async function c(e){await chrome.storage.sync.set(e)}function b(e){if(!e||typeof e!="object")return!1;let t=e;return t.type==="SET_ENABLED"||t.type==="SET_PRESET"||t.type==="SET_MASTER_GAIN"||t.type==="SET_EQ_ENABLED"||t.type==="SET_VOCAL_ENHANCE"||t.type==="GET_STATUS"}function h(e){if(!e||typeof e!="object")return!1;let t=e;return t.type==="STATUS"||t.type==="METERING"}function p(e){let t=e?"ON":"",o=e?"#4CAF50":"#9E9E9E";chrome.action.setBadgeText({text:t}),chrome.action.setBadgeBackgroundColor({color:o})}async function P(){return(await chrome.tabs.query({})).filter(t=>t.url?.includes("youtube.com/watch")||t.url?.includes("youtube.com/shorts")||t.url?.includes("music.youtube.com"))}async function E(e){let t=await P();if(t.length===0)return;let n=(await Promise.allSettled(t.map(a=>a.id?chrome.tabs.sendMessage(a.id,e):Promise.resolve(void 0)))).find(a=>a.status==="fulfilled"&&a.value);return n?.status==="fulfilled"?n.value:void 0}async function D(e){let[t]=await chrome.tabs.query({active:!0,currentWindow:!0});if(t?.id&&(t.url?.includes("youtube.com/watch")||t.url?.includes("youtube.com/shorts")||t.url?.includes("music.youtube.com")))try{return await chrome.tabs.sendMessage(t.id,e)}catch{return}return E(e)}chrome.runtime.onMessage.addListener((e,t,o)=>{if(b(e)){if(e.type==="SET_ENABLED"?(c({enabled:e.enabled}),p(e.enabled)):e.type==="SET_PRESET"&&c({presetId:e.presetId}),e.type==="GET_STATUS")return D(e).then(n=>{o(n)}),!0;E(e);return}if(h(e)&&t.tab){e.type==="STATUS"&&p(e.data.enabled),chrome.runtime.sendMessage(e).catch(()=>{});return}});chrome.runtime.onInstalled.addListener(async e=>{e.reason==="install"&&await c({enabled:!1,presetId:"sleep",masterGainDb:0});let t=await u();p(t.enabled)});chrome.runtime.onStartup.addListener(async()=>{let e=await u();p(e.enabled)});
