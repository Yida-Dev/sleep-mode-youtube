# 产品定位与功能规划

## 一、产品定位

### 1.1 一句话描述

> **YouTube Sleep Mode** - 一键把任何 YouTube 视频变成适合睡觉听的版本

### 1.2 核心价值主张

解决用户睡前听 YouTube 时遇到的音频问题：
- 不再被突然的广告、笑声、音效惊醒
- 全程音量平稳，无需手动调节
- 人声清晰，背景音乐不干扰
- 可调节语速，更适合放松入睡

### 1.3 目标用户

| 用户类型 | 核心需求 | 优先级 |
|---------|---------|--------|
| 失眠者 | 听 ASMR/冥想视频入睡，不被打扰 | P0 |
| 睡眠依赖者 | 每晚需要背景音，音量要平稳 | P0 |
| 播客听众 | 睡前听播客，不想被主播笑声吵醒 | P1 |
| 学习者 | 睡前听有声书/教程，需要降速 | P2 |

### 1.4 竞品对比

| 功能 | YouTube Premium | Stable Volume | 音量扩展 | 本产品 |
|------|----------------|---------------|---------|--------|
| 去广告 | ✅ | ❌ | ❌ | ✅ (下载处理) |
| 音量归一化 | ❌ | ✅ (有限) | ✅ (仅放大) | ✅ |
| 动态压缩 | ❌ | ❌ | ❌ | ✅ |
| 瞬态抑制 | ❌ | ❌ | ❌ | ✅ |
| 人声/背景分离 | ❌ | ❌ | ❌ | ✅ (V2) |
| 变速播放 | ✅ | ✅ | ❌ | ✅ |
| 睡眠定时 | ✅ | ✅ | ❌ | ✅ |

---

## 二、功能规划

### 2.1 MVP 功能（必须完成）

基于用户痛点优先级，MVP 需要解决最核心的问题：

#### 功能 1：音量归一化 + 动态压缩

**解决痛点：** 音量忽大忽小、视频间音量不一致

**技术方案：**
- 响度归一化到 -16 LUFS（适合耳机收听）
- 动态范围压缩（ratio 4:1，threshold -20dB）
- 软限幅防止削波

**用户感知：**
- 全程音量平稳，不需要手动调节
- 安静部分能听清，响亮部分不刺耳

#### 功能 2：瞬态抑制

**解决痛点：** 突然的笑声、掌声、音效惊醒用户

**技术方案：**
- 瞬态检测（attack time < 10ms 的能量突变）
- 快速限幅（fast limiter）
- 可选：基于 AI 的音频事件检测

**用户感知：**
- 不会被突然的声音吓到
- 整体听感更加平滑

#### 功能 3：YouTube 视频下载与处理

**解决痛点：** 广告惊醒（通过下载跳过广告）

**技术方案：**
- 使用 yt-dlp 下载音频
- 服务端处理后返回
- 支持常见格式输出

**用户感知：**
- 输入 YouTube 链接
- 获得处理后的无广告音频

### 2.2 V2 功能（增强体验）

#### 功能 4：人声/背景音乐分离

**解决痛点：** 背景音乐太吵，干扰人声

**技术方案：**
- 使用 Demucs 或 Spleeter 模型分离
- 允许用户调节人声/背景比例
- 可选完全去除背景音乐

**用户感知：**
- 人声更清晰
- 可以只听人声，不要音乐

#### 功能 5：变速不变调

**解决痛点：** 语速太快，不适合放松

**技术方案：**
- WSOLA 或 Phase Vocoder 算法
- 支持 0.5x - 1.0x 速度调节
- 保持音调不变

**用户感知：**
- 可以选择 0.75x 等慢速播放
- 语调自然，不像慢放

#### 功能 6：智能跳过 Intro/Outro

**解决痛点：** ASMR 视频开头/结尾有响亮音乐

**技术方案：**
- 检测开头/结尾的高能量片段
- 自动淡入淡出或跳过
- 基于音频特征而非时间

**用户感知：**
- 视频直接进入正题
- 不会被结尾的订阅提醒吵到

### 2.3 V3 功能（差异化）

#### 功能 7：低频增强/高频柔化

**解决痛点：** 人声音调过高，不够舒缓

**技术方案：**
- EQ 调节：降低 2-4kHz（尖锐感），增强 100-200Hz（温暖感）
- 可选降调处理

#### 功能 8：渐进式淡出

**解决痛点：** 视频结束时突然静音

**技术方案：**
- 检测视频即将结束
- 自动添加渐出效果

#### 功能 9：睡眠播放列表

**解决痛点：** 用户想连续播放多个处理后的音频

**技术方案：**
- 保存处理历史
- 创建播放列表
- 无缝衔接播放

---

## 三、产品形态选择

### 3.1 方案对比

| 形态 | 优点 | 缺点 | 开发成本 |
|------|------|------|---------|
| **Web App** | 跨平台、易分发、处理能力强 | 需粘贴链接、需服务器 | 中 |
| **浏览器扩展** | 无需下载、实时处理 | 处理能力受限、仅限桌面 | 中 |
| **桌面应用** | 处理能力强、离线使用 | 分发成本高、需安装 | 高 |
| **移动 App** | 场景契合、随时使用 | 开发成本高、审核风险 | 高 |

### 3.2 MVP 推荐：Web App

**理由：**
1. 技术可控，能做重度音频处理
2. 用户流程清晰：粘贴链接 → 处理 → 播放/下载
3. 跨平台，PC 和手机都能用
4. 后期可扩展为浏览器扩展或 PWA

**用户流程：**
```
1. 用户打开网站
2. 粘贴 YouTube 链接
3. 选择处理选项（可选）
4. 点击"优化"
5. 等待处理（显示进度）
6. 在线播放 或 下载音频
```

---

## 四、技术架构（初步）

### 4.1 整体架构

```
用户浏览器
    ↓
前端 (React/Vue)
    ↓
后端 API (Node.js / Python)
    ↓
处理队列 (Redis)
    ↓
音频处理 Worker
    ├── yt-dlp (下载)
    ├── ffmpeg (基础处理)
    └── AI 模型 (人声分离，可选)
    ↓
对象存储 (S3/R2)
    ↓
返回处理结果
```

### 4.2 核心技术选型

| 组件 | 技术选择 | 理由 |
|------|---------|------|
| 视频下载 | yt-dlp | 开源、稳定、支持多平台 |
| 音频处理 | ffmpeg + sox | 成熟、功能全面 |
| 动态压缩 | ffmpeg compand/loudnorm | 内置滤镜，无需额外依赖 |
| 人声分离 | Demucs (V2) | Meta 开源、效果好 |
| 后端 | Python (FastAPI) | 与音频处理库集成好 |
| 前端 | React + Tailwind | 快速开发、现代 UI |
| 部署 | Cloudflare Workers + R2 | 低成本、全球加速 |

### 4.3 音频处理流水线

```
输入音频
    ↓
[1] 响度分析 (ffmpeg loudnorm 第一遍)
    ↓
[2] 响度归一化 (目标 -16 LUFS)
    ↓
[3] 动态压缩 (ratio 4:1, threshold -20dB)
    ↓
[4] 瞬态检测与抑制 (可选)
    ↓
[5] 软限幅 (peak -1dB)
    ↓
[6] 变速处理 (可选，默认 1.0x)
    ↓
输出音频
```

---

## 五、MVP 验收标准

### 5.1 功能验收

| 功能 | 验收标准 |
|------|---------|
| 链接解析 | 支持标准 YouTube 链接、短链接、Shorts |
| 音频下载 | 成功率 > 95%，支持各种时长视频 |
| 音量归一化 | 输出响度在 -16 LUFS ± 1dB |
| 动态压缩 | 动态范围 < 10dB（原始可能 > 20dB） |
| 瞬态抑制 | 无明显的突发音量峰值 |
| 在线播放 | 支持主流浏览器，支持进度条 |
| 下载功能 | 支持 MP3/M4A 格式下载 |

### 5.2 性能验收

| 指标 | 目标 |
|------|------|
| 处理速度 | 10 分钟视频 < 30 秒处理完成 |
| 并发处理 | 支持同时 10+ 任务 |
| 存储保留 | 处理结果保留 24 小时 |

### 5.3 测试用例

根据需求文档提供的测试链接：

1. `https://www.youtube.com/watch?v=6_PI1l5NKL8` (前2分钟)
2. `https://www.youtube.com/watch?v=7ARBJQn6QkM` (前2分钟)
3. `https://youtube.com/shorts/l7dIb1-Aymk`
4. `https://youtube.com/shorts/Th12tPRHX5s`

---

## 六、项目里程碑

### 阶段 1：需求与设计（当前）
- [x] 用户需求调研
- [x] 产品定位与功能规划
- [ ] 技术方案详细设计
- [ ] UI/UX 设计

### 阶段 2：MVP 开发
- [ ] 后端 API 开发
- [ ] 音频处理流水线
- [ ] 前端界面开发
- [ ] 集成测试

### 阶段 3：上线与验证
- [ ] 部署上线
- [ ] 测试用例验证
- [ ] 用户反馈收集

### 阶段 4：V2 迭代
- [ ] 人声分离功能
- [ ] 变速功能
- [ ] 用户账号系统

---

## 七、风险与应对

| 风险 | 影响 | 应对措施 |
|------|------|---------|
| YouTube 下载限制 | 核心功能不可用 | 使用 yt-dlp，保持更新；备选方案：用户自行上传 |
| 处理速度慢 | 用户体验差 | 异步处理 + 进度显示；优化 ffmpeg 参数 |
| 服务器成本 | 运营成本高 | 使用 Cloudflare Workers；限制免费用户用量 |
| 版权问题 | 法律风险 | 仅处理用户自己的内容；不存储原始视频 |

---

## 八、待讨论问题

1. **产品名称**：YouTube Sleep Mode / SleepTube / 其他？
2. **免费/付费模式**：免费试用 + 付费订阅？限制处理次数？
3. **是否需要账号系统**：MVP 阶段可以无账号使用？
4. **音频存储策略**：处理结果保留多久？用户是否可以保存？
